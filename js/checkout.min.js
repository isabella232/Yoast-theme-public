!function(a){"use strict";function b(){h=a(document.body),c()}function c(){h.on("edd_quantity_updated",e),h.on("change",".yst-edd-pricing-switcher",f),h.on("edd_cart_billing_address_updated",g),a(document).ajaxComplete(d),a("#edd_first").focus()}function d(a,b,c){if(c.url===edd_global_vars.ajaxurl&&"undefined"!=typeof b.responseJSON){var d=b.responseJSON;d&&"valid"==d.msg&&"0.00"==d.total_plain&&location.reload()}}function e(a,b){EDD_Checkout.recalculate_taxes()}function f(b){var c=a(b.currentTarget),d=c.data("download-id"),e=c.val(),f={action:"yst_update_variation",download_id:d,price_id:e};a.ajax({type:"POST",data:f,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0}}).success(function(a){"success"===a.status&&EDD_Checkout.recalculate_taxes()})}function g(b,c){"nostates"===c?a("#edd-card-state-wrap").hide():a("#edd-card-state-wrap").show()}var h;a(b)}(jQuery),function(a){function b(){e=parseInt(a("#steps-progress").data("step"),10),a("#yst-to-step-3").on("click",c.bind(window,3)),a("#yst-to-step-4").on("click",c.bind(window,4))}function c(a,b){a>e&&(d(),b.preventDefault())}function d(){switch(e){case 2:a("#edd_next_button").click();break;case 3:a("#edd-purchase-button").click()}}var e;a(b)}(jQuery),function(a){function b(c,d){a("#yst-edd-btw-wrap .fa-spinner").addClass("show"),k.start();var e=jQuery.post(yoast_com_checkout_vars.ajaxurl,{action:"yst_check_vat",country:c,vat_nr:d},function(b){a("#yst-edd-btw-wrap .fa-spinner").removeClass("show"),a("#vaterror").remove(),"1"==b?(a("#yst_btw").removeClass("error").addClass("valid"),EDD_Checkout.recalculate_taxes(),i=!0,k.success()):"2"==b?(a("#yst_btw").removeClass("valid").addClass("error"),EDD_Checkout.recalculate_taxes(),jQuery("#yst-edd-btw-wrap").append('<span id="vaterror" class="error">We cannot check if your VAT number is correct because the VAT checking system for the EU is currently down. We\'re sorry for the inconvenience. Please send us an email on <a href="mailto:support@yoast.com">support@yoast.com</a> or try again later.</span>'),i=!1,k.failed()):(a("#yst_btw").removeClass("valid").addClass("error"),EDD_Checkout.recalculate_taxes(),jQuery("#yst-edd-btw-wrap").append('<span id="vaterror" class="error">We cannot verify this VAT number, this means you will have to pay VAT. Please make sure you\'ve entered the number correctly.</span>'),i=!1,k.notVerified())});e.fail(function(){setTimeout(b,1e3)})}function c(a){return Math.round(100*a)/100}function d(b,d){var e=d.response;i&&0!==e.tax_rate_raw?(e.total_raw=e.total_raw-parseFloat(e.tax_raw),e.tax_raw=0,e.tax_rate_raw=0,e.tax_rate="0%",e.total="$ "+c(e.total_raw),e.tax="$"+c(e.tax_raw),a(".edd_cart_amount").html(e.total),a(".yst-tax-rate").html(e.tax_rate.replace("%","")),a(".edd_cart_tax_amount").html(e.tax)):f(e),a("#yst_secondary_tax_rate").html(e.tax_rate.replace("%","")),a("#yst_secondary_tax").html(e.tax)}function e(){var b=a("#billing_country"),c=b.val();""===c?a("#edd-card-state-wrap").hide():b.trigger("change")}function f(b){var c=a("#billing_country").val(),d=a("#yst-edd-btw-wrap");return"NL"==c?(d.hide().after('<p id="yst-dutch-vat-notice"><strong>Please note:</strong> VAT will be added to the invoice. Since Yoast is based in the Netherlands we cannot reverse charge the VAT.</p>'),void a(".edd_cart_tax_row").css("display","table-row")):(a("#yst-dutch-vat-notice").remove(),b&&0===b.tax_rate_raw?(d.hide(),void a(".edd_cart_tax_row").css("display","none")):(a(".edd_cart_tax_row").css("display","table-row"),void d.show()))}function g(){a(".chosen-select").chosen(),h.on("edd_cart_billing_address_updated",function(){a("#edd-card-state-wrap .chosen-container").remove(),a('select[name="card_state"]').chosen()})}var h,i=!1,j=function(){this.startTime=0,this.endTime=0,this.duration=0,"undefined"!=typeof __gaTracker?this.tracker=__gaTracker:this.tracker=function(){}};j.prototype.start=function(){this.startTime=(new Date).getTime(),this.endTime=0,this.duration=0,this.tracker("send","event","checkout","vat-check","start")},j.prototype.end=function(){this.endTime=(new Date).getTime(),this.duration=this.endTime-this.startTime},j.prototype.notVerified=function(){this.end(),this.tracker("send","event","checkout","vat-check","cannot verify",this.duration)},j.prototype.failed=function(){this.end(),this.tracker("send","event","checkout","vat-check","failed",this.duration)},j.prototype.success=function(){this.end(),this.tracker("send","event","checkout","vat-check","ok",this.duration)};var k=new j;jQuery(document).ready(function(a){h=a("body"),e(),g(),h.on("edd_taxes_recalculated",d),a("#card_number").payment("formatCardNumber"),a("#card-cvc").payment("formatCardCVC");a("#card_number").on("input",function(){a.payment.validateCardNumber(a(this).val())?a(this).removeClass("error").addClass("valid"):a(this).removeClass("valid").addClass("error"),""!=a("#card_cvc").val()&&(a.payment.validateCardCVC(a("#card_cvc").val(),a.payment.cardType(a(this).val()))?a("#card_cvc").removeClass("error").addClass("valid"):a("#card_cvc").removeClass("valid").addClass("error"))}),a("#card_cvc").on("input",function(){a.payment.validateCardCVC(a(this).val(),a.payment.cardType(a("#card_number").val()))?a(this).removeClass("error").addClass("valid"):a(this).removeClass("valid").addClass("error")}),a("#card_exp_year").on("input",function(){var b=a("#card_exp_month").val(),c=a(this).val();return 4===c.length?(c=c.slice(-2),void a(this).val(c)):void(""!=b&&(a.payment.validateCardExpiry(b,c)?a("edd-input-cvc").removeClass("error").addClass("valid"):a("edd-input-cvc").removeClass("valid").addClass("error")))}),a("#edd_purchase_form").validate({unhighlight:function(b,c,d,e){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).hasClass("ignore")?a(b).removeClass(c).removeClass(d):a(b).removeClass(c).addClass(d)},errorClass:"error error-message",rules:{edd_email:{required:!0,email:!0},edd_first:"required",card_name:"required",card_address:{required:!0,minlength:2},card_city:{required:!0,minlength:2},card_zip:{required:!0,minlength:2},billing_country:"required",card_state:"required",edd_agree_to_terms:"required"},messages:{edd_first:"Please enter your first name",edd_email:"Please enter a valid email address",edd_agree_to_terms:"<strong>Error</strong> - Please accept our terms: ",card_name:"Please enter the name on your credit card",card_address:"Please enter your billing address",card_zip:"Please enter your zip / postal code",card_state:"Please enter your state",card_city:"Please enter your city",billing_country:"Please enter your country"}}),h.on("change","#yst_btw",function(){var c=a("#yst_btw").val(),d=a("#billing_country").val();""!=c&&b(d,c)})})}(jQuery);
//# sourceMappingURL=checkout.min.js.map